<script>
    let adminName = ''
    $(document).ready(async () => {
        const _user = JSON.parse(user)
        await axios(axiosConfig(`${config.SERVER_URL}${config.URLS.USER_DETAILS}/${_user._id}`, 'GET'))
            .then((resp) => {
                const { data: { data } } = resp
                adminName = data.name
                if (data?.profilePic) $('#ProfileImage').attr('src', data.profilePic)
                $('.idd').text(data.email)
                $('#NameInput').text(data.name)
                $('.skeleton-text').attr('style', 'width: auto')
                $('.skeleton-text').removeClass('skeleton')
            })
            .catch((e) => ToastMsg(e?.response?.data?.message, 'Error'))

        $('#Edit_Modal').on('show.modal.bs', function () {
            $('#_NameInput').val(adminName)
        })
    })
    $('#UpdateDetails').off().on('click', async function () {
        const form = $('#Edit_Form')
        form.validate({
            rules: {
                name: {
                    required: true,
                    maxlength: 30,
                    minlength: 3,
                }
            }
        })
        if (form.valid()) {
            $('#UpdateDetails').text('Updating...')
            const name = $('#_NameInput').val().trim()
            await axios(axiosConfig(`${config.SERVER_URL}${config.URLS.UPDATE_PROFILE}`, 'PATCH', { name }))
                .then((resp) => {
                    $('#UpdateDetails').text('Update')
                    adminName = name
                    $('#Edit_Modal').modal('hide')
                    $('#NameInput').text(name)
                    ToastMsg(resp?.data?.message, 'Success')
                })
                .catch((err) => {
                    $('#UpdateDetails').text('Update');
                    ToastMsg(err?.response?.data?.message, 'Error')
                })
        }
    })
    /** Preview Image before Upload*/
    $('#OpenImgUpload').click(function () { $('#imgupload').trigger('click'); });
    let imageInput = document.getElementById("imgupload")
    let preview = document.getElementById("ProfileImage")
    imageInput.addEventListener("change", async (event) => {
        let url = URL.createObjectURL(event.target.files[0])
        preview.setAttribute("src", url)
        const formdata = new FormData()
        formdata.append('image', event.target.files[0])
        await axios(axiosConfig(`${config.SERVER_URL}${config.URLS.UPLOAD_PROFILE_IMAGE}`, 'POST', formdata, true))
            .then((resp) => {
                ToastMsg(resp?.data?.message, 'Success')
            })
            .catch((err) => ToastMsg(err?.response?.data?.message, 'Error'))

    })
</script>